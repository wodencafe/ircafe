spring:
  application:
    name: "ircafe"
  flyway:
    # We run Flyway manually for the optional chat logging DB only when ircafe.logging.enabled=true.
    enabled: false
  main:
    headless: false
  config:
    # Load runtime state/config after application.yml so it can override defaults.
    # This file is also where we persist changes like auto-join channels and nick.
    import: "optional:file:${ircafe.runtime-config:${user.home}/.config/ircafe/ircafe.yml}"

ircafe:
  ui:
    # If true (default), connect to all configured servers automatically after the UI loads.
    # If false, IRCafe starts disconnected and you can connect manually using the Connect button.
    autoConnectOnStart: true

    # Timestamp prefix shown for status/error lines in the chat transcript.
    # Format uses Java time patterns (ex: "HH:mm:ss", "HH:mm", "h:mm a").
    timestamps:
      enabled: true
      format: "HH:mm:ss"
      # If enabled, IRCafe will also prepend a timestamp to regular user chat message lines.
      includeChatMessages: true
      # If enabled, IRCafe will prepend timestamps to presence/folded lines (join/part/quit/nick).
      includePresenceMessages: true
    # Chat history load behavior
    # How many lines to prefill into the transcript when selecting a channel or user.
    # 0 disables prefill.
    chatHistoryInitialLoadLines: 100

    # How many lines to fetch per click for the in-transcript "Load older messages..." button.
    chatHistoryPageSize: 200

    # Outgoing message custom color (lines you send that are locally echoed into the transcript).
    # Default: false
    clientLineColorEnabled: false
    # Color when enabled (hex like "#RRGGBB").
    clientLineColor: "#6AA2FF"

    # Optional chat transcript color overrides (hex like "#RRGGBB").
    # Leave unset to follow the active theme/preset defaults.
    # chatThemePreset: DEFAULT
    # chatTimestampColor: "#7F8FA6"
    # chatSystemColor: "#7F8FA6"
    # chatMessageColor: "#E3E8EF"
    # chatNoticeColor: "#D4AE66"
    # chatActionColor: "#E3E8EF"
    # chatErrorColor: "#C96E6E"
    # chatPresenceColor: "#7F8FA6"
    # chatMentionBgColor: "#2D6BFF"
    # chatMentionStrength: 35

    # Inline image embedding (direct links to .png/.jpg/.gif/.webp). Default: OFF.
    imageEmbedsEnabled: false

    # Maximum width cap for inline image embeds (pixels). If 0, no extra cap (only scales down to fit the viewport).
    imageEmbedsMaxWidthPx: 0

    # Maximum height cap for inline image embeds (pixels). If 0, no extra cap.
    imageEmbedsMaxHeightPx: 0

    # Enable animated GIF playback for inline images. If false, GIFs render as a still first frame.
    imageEmbedsAnimateGifs: true

    # Hostmask discovery (USERHOST) anti-flood settings. This is only used when hostmask-based ignore rules exist
    # and some nicks in a channel are missing hostmasks.
    hostmaskDiscovery:
      # If false, IRCafe will never send USERHOST (hostmask discovery will rely solely on userhost-in-names / passive capture).
      userhostEnabled: true
      # Minimum interval between USERHOST commands per server (seconds).
      userhostMinIntervalSeconds: 7
      # Maximum number of USERHOST commands per minute per server.
      userhostMaxCommandsPerMinute: 6
      # Per-nick cooldown to avoid repeated USERHOST requests (minutes).
      userhostNickCooldownMinutes: 30
      # Max nicks per USERHOST command (1..5; the protocol typically caps at 5).
      userhostMaxNicksPerCommand: 5

    # Collapse presence noise in channel logs (join/part/quit/nick) into Lounge-style fold blocks.
    # Default: true.
    presenceFoldsEnabled: true

    # Nick color section
    nickColoringEnabled: true
    nickColorMinContrast: 4.5   # 4.5 is a solid default

    # Docking/layout defaults (best-effort "first open" sizes). After you drag split dividers,
    # those sizes are preserved by IRCafe's split-pane lock logic.
    layout:
      serverDockWidthPx: 240
      userDockWidthPx: 140

    # System tray integration
    tray:
      # If true (default), show a system tray icon when supported by the OS.
      enabled: true
      # If true, the window close button hides IRCafe to the tray instead of exiting. Default: false.
      closeToTray: false
      # If true, minimizing the window hides IRCafe to the tray. Default: false.
      minimizeToTray: false
      # If true, start hidden (tray icon only). Default: false.
      startMinimized: false
      # Desktop notifications for highlights. Default: true.
      notifyHighlights: true
      # Desktop notifications for private messages. Default: true.
      notifyPrivateMessages: true
      # Desktop notifications for connection state changes. Default: false.
      notifyConnectionState: false
      # Only notify when the main window is not focused/active. Default: true.
      notifyOnlyWhenUnfocused: true
      # Only notify when the main window is minimized or hidden to tray. Default: false.
      notifyOnlyWhenMinimizedOrHidden: false
      # Suppress notifications for the currently active buffer/target. Default: true.
      notifySuppressWhenTargetActive: true
      # Linux only: prefer D-Bus notifications with click actions (falls back to notify-send). Default: true.
      linuxDbusActionsEnabled: true
      # Desktop notification backend mode. Valid values:
      # - auto (recommended): native OS backend first, then two-slices fallback
      # - native-only: native OS backend only
      # - two-slices-only: skip native backends and use two-slices directly
      notificationBackend: auto

      # Play a sound alongside desktop notifications. Default: true.
      notificationSoundsEnabled: true

      # Which bundled sound to use (BuiltInSound enum name).
      # Valid values: NOTIF_1 .. NOTIF_21
      notificationSound: "NOTIF_1"

      # Optional: use a custom file stored under the runtime config directory.
      # If enabled, IRCafe plays `notificationSoundCustomPath` instead of a bundled sound.
      # Supported formats: MP3, WAV.
      # notificationSoundUseCustom: false
      # notificationSoundCustomPath: "sounds/my-notification.mp3"
    # Optional: custom palette (hex strings). If omitted, uses built-in 32-color palette.
    # nickColors:
    #   - "#E57373"
    #   - "#64B5F6"
    #   ...

    # Optional: per-nick overrides (case-insensitive keys)
    nickColorOverrides:
        "NickServ": "#FFB300"
        "ChanServ": "#26A69A"

    # Optional integrations surfaced under the Server Tree "Application" root.
    appDiagnostics:
      assertjSwing:
        # Enable AssertJ Swing runtime integration (if AssertJ Swing is on the classpath),
        # otherwise IRCafe uses a built-in fallback EDT violation detector.
        enabled: true
        # Poll EDT responsiveness in the background.
        edtFreezeWatchdogEnabled: true
        # If EDT stalls longer than this, write freeze events to Application -> AssertJ Swing.
        edtFreezeThresholdMs: 2500
        # Watchdog poll cadence.
        edtWatchdogPollMs: 500
        # Fallback detector throttling: minimum interval between repeated off-EDT violation reports.
        edtFallbackViolationReportMs: 5000
        # Optional issue actions when EDT freeze/violation problems are detected.
        onIssuePlaySound: false
        onIssueShowNotification: false

      jfr:
        # Master toggle for runtime JFR diagnostics shown under Application -> JFR.
        # You can change this live in the JFR panel, and IRCafe persists it to runtime config.
        enabled: true

      jhiccup:
        # Optional external jHiccup process integration.
        # Set enabled=true and point jarPath to your jHiccup jar to stream output into
        # Application -> jHiccup.
        enabled: false
        # Absolute path or path relative to the runtime config directory.
        # jarPath: "tools/jHiccup.jar"
        javaCommand: "java"
        # Optional args passed after "-jar <jarPath>".
        args: []

  soju:
    # Soju bouncer integration.
    discovery:
      # If true (default), IRCafe will attempt to discover soju bouncer networks ephemerally.
      # If false, IRCafe will not request soju network discovery (BOUNCER LISTNETWORKS).
      enabled: true
    # Networks are discovered ephemerally; this persists only auto-connect intent.
    # autoConnect:
    #   soju:
    #     libera: true
    #     oftc: true

  znc:
    # ZNC bouncer integration.
    discovery:
      # If true (default), IRCafe will attempt to discover ZNC networks ephemerally.
      # If false, IRCafe will not probe *status for ListNetworks.
      enabled: true
    # Networks are discovered ephemerally; this persists only auto-connect intent.
    # Keyed by the bouncer/control connection id from `irc.servers[].id`.
    # Network keys are normalized (case-insensitive) using ZNC's network segment sanitizer.
    # autoConnect:
    #   znc-main:
    #     libera: true
    #     oftc: true

  pushy:
    # Optional Pushy integration for IRC event notifications.
    # Configure this from Preferences -> Tray & Notifications -> Pushy.
    enabled: false
    endpoint: "https://api.pushy.me/push"
    # Secret API key from your Pushy app dashboard.
    # apiKey: "replace-me"
    # Set exactly one destination:
    # deviceToken: "replace-me"
    # topic: "my-ircafe-topic"
    titlePrefix: "IRCafe"
    connectTimeoutSeconds: 5
    readTimeoutSeconds: 8

  logging:
    # Master toggle for persistence logging (chat history / message logs).
    # Default: false
    enabled: false

    # If true (default), "soft ignore" lines are still logged, but flagged.
    logSoftIgnoredLines: true

    # If true (default), private-message/query lines are persisted.
    logPrivateMessages: true

    # If true (default), PM/query targets are remembered and restored in the chat list.
    # Stored per server in autoJoin using a query: prefix.
    savePrivateMessageList: true

    # Default behavior: keep logs indefinitely.
    keepForever: true
    # Optional retention window. 0 means no retention (keep forever).
    retentionDays: 0
    # Max queued lines waiting for DB writes before new lines are dropped.
    writerQueueMax: 50000
    # Number of queued lines written per DB transaction flush.
    writerBatchSize: 250

    # Embedded HSQLDB settings.
    hsqldb:
      # Base filename only (no extension). HSQLDB will create .data/.script/.properties files.
      fileBaseName: "ircafe-chatlog"
      # Store the DB next to the runtime YAML config file (loaded via spring.config.import).
      nextToRuntimeConfig: true

irc:
  client:
    version: "${IRCAFE_CTCP_VERSION:IRCafe}"

    # Auto-reconnect policy (client-side). These defaults are safe for most setups.
    reconnect:
      enabled: true
      # First retry delay.
      initialDelayMs: 1000
      # Maximum delay between retries.
      maxDelayMs: 120000
      # Exponential backoff multiplier.

      multiplier: 2.0
      # Random +/- jitter (0.0 - 0.75) applied to the computed delay.
      jitterPct: 0.20
      # 0 = infinite attempts.
      maxAttempts: 0


    # Heartbeat / ping-timeout detection (client-side).
    # If enabled, IRCafe will close the connection if it sees no inbound traffic for the timeout.
    # This helps recover from silent network drops.
    heartbeat:
      enabled: true
      # How often to check for inbound traffic (ms).
      checkPeriodMs: 15000
      # If no inbound traffic is seen for this long, close the bot (ms).
      timeoutMs: 360000

    tls:
      # INSECURE: if true, IRCafe will accept any TLS certificate (expired/self-signed/etc).
      trustAllCertificates: false

  servers:
    - id: "libera"
      host: "irc.libera.chat"
      port: 6697
      tls: true
      serverPassword: "${IRCAFE_SERVER_PASSWORD:}"
      nick: "${IRCAFE_NICK:IRCafeUser}"
      login: "${IRCAFE_IDENT:ircafe}"
      realName: "${IRCAFE_REALNAME:IRCafe User}"

      sasl:
        enabled: false
        username: "${IRCAFE_SASL_USERNAME:}"
        password: "${IRCAFE_SASL_PASSWORD:}"
        mechanism: "PLAIN"
        # If true (default), a SASL auth failure will immediately disconnect
        # and surface the error to the UI. Set false if SASL is optional and you want to stay
        # connected even when SASL fails.
        # disconnectOnFailure: true

      autoJoin:
        - "#test"

      # "Perform" list: commands to run right after a successful connect.
      # Lines starting with "/" will be treated as IRCafe commands; others may be treated as raw IRC.
      # (Execution is implemented in the next step.)
      # perform:
      #   - "/msg NickServ IDENTIFY yourpassword"
      #   - "/mode $me +i"
