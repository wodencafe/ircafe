spring:
  application:
    name: "ircafe"
  flyway:
    # We run Flyway manually for the optional chat logging DB only when ircafe.logging.enabled=true.
    enabled: false
  main:
    headless: false
  config:
    # Load runtime state/config after application.yml so it can override defaults.
    # This file is also where we persist changes like auto-join channels and nick.
    import: "optional:file:${ircafe.runtime-config:${user.home}/.config/ircafe/ircafe.yml}"

ircafe:
  ui:
    # If true (default), connect to all configured servers automatically after the UI loads.
    # If false, IRCafe starts disconnected and you can connect manually using the Connect button.
    autoConnectOnStart: true

    # Timestamp prefix shown for status/error lines in the chat transcript.
    # Format uses Java time patterns (ex: "HH:mm:ss", "HH:mm", "h:mm a").
    timestamps:
      enabled: true
      format: "HH:mm:ss"
      # If enabled, IRCafe will also prepend a timestamp to regular user chat message lines.
      includeChatMessages: false
    # Chat history load behavior
    # How many lines to prefill into the transcript when selecting a channel or user.
    # 0 disables prefill.
    chatHistoryInitialLoadLines: 100

    # How many lines to fetch per click for the in-transcript "Load older messages..." button.
    chatHistoryPageSize: 200

    # Outgoing message custom color (lines you send that are locally echoed into the transcript).
    # Default: false
    clientLineColorEnabled: false
    # Color when enabled (hex like "#RRGGBB").
    clientLineColor: "#6AA2FF"


    # Inline image embedding (direct links to .png/.jpg/.gif/.webp). Default: OFF.
    imageEmbedsEnabled: false

    # Maximum width cap for inline image embeds (pixels). If 0, no extra cap (only scales down to fit the viewport).
    imageEmbedsMaxWidthPx: 0

    # Maximum height cap for inline image embeds (pixels). If 0, no extra cap.
    imageEmbedsMaxHeightPx: 0

    # Enable animated GIF playback for inline images. If false, GIFs render as a still first frame.
    imageEmbedsAnimateGifs: true

    # Hostmask discovery (USERHOST) anti-flood settings. This is only used when hostmask-based ignore rules exist
    # and some nicks in a channel are missing hostmasks.
    hostmaskDiscovery:
      # If false, IRCafe will never send USERHOST (hostmask discovery will rely solely on userhost-in-names / passive capture).
      userhostEnabled: true
      # Minimum interval between USERHOST commands per server (seconds).
      userhostMinIntervalSeconds: 7
      # Maximum number of USERHOST commands per minute per server.
      userhostMaxCommandsPerMinute: 6
      # Per-nick cooldown to avoid repeated USERHOST requests (minutes).
      userhostNickCooldownMinutes: 30
      # Max nicks per USERHOST command (1..5; the protocol typically caps at 5).
      userhostMaxNicksPerCommand: 5

    # Collapse presence noise in channel logs (join/part/quit/nick) into Lounge-style fold blocks.
    # Default: true.
    presenceFoldsEnabled: true

    # Nick color section
    nickColoringEnabled: true
    nickColorMinContrast: 4.5   # 4.5 is a solid default

    # Docking/layout defaults (best-effort "first open" sizes). After you drag split dividers,
    # those sizes are preserved by IRCafe's split-pane lock logic.
    layout:
      serverDockWidthPx: 240
      userDockWidthPx: 140
    # Optional: custom palette (hex strings). If omitted, uses built-in 32-color palette.
    # nickColors:
    #   - "#E57373"
    #   - "#64B5F6"
    #   ...

    # Optional: per-nick overrides (case-insensitive keys)
    nickColorOverrides:
        "NickServ": "#FFB300"
        "ChanServ": "#26A69A"

  logging:
    # Master toggle for persistence logging (chat history / message logs).
    # Default: false
    enabled: false

    # If true (default), "soft ignore" lines are still logged, but flagged.
    logSoftIgnoredLines: true

    # Default behavior: keep logs indefinitely.
    keepForever: true
    # Optional retention window. 0 means no retention (keep forever).
    retentionDays: 0

    # Embedded HSQLDB settings.
    hsqldb:
      # Base filename only (no extension). HSQLDB will create .data/.script/.properties files.
      fileBaseName: "ircafe-chatlog"
      # Store the DB next to the runtime YAML config file (loaded via spring.config.import).
      nextToRuntimeConfig: true

irc:
  client:
    version: "${IRCAFE_CTCP_VERSION:IRCafe}"

    # Auto-reconnect policy (client-side). These defaults are safe for most setups.
    reconnect:
      enabled: true
      # First retry delay.
      initialDelayMs: 1000
      # Maximum delay between retries.
      maxDelayMs: 120000
      # Exponential backoff multiplier.

      multiplier: 2.0
      # Random +/- jitter (0.0 - 0.75) applied to the computed delay.
      jitterPct: 0.20
      # 0 = infinite attempts.
      maxAttempts: 0


    # Heartbeat / ping-timeout detection (client-side).
    # If enabled, IRCafe will close the connection if it sees no inbound traffic for the timeout.
    # This helps recover from silent network drops.
    heartbeat:
      enabled: true
      # How often to check for inbound traffic (ms).
      checkPeriodMs: 15000
      # If no inbound traffic is seen for this long, close the bot (ms).
      timeoutMs: 360000

  servers:
    - id: "libera"
      host: "irc.libera.chat"
      port: 6697
      tls: true
      serverPassword: "${IRCAFE_SERVER_PASSWORD:}"
      nick: "${IRCAFE_NICK:IRCafeUser}"
      login: "${IRCAFE_IDENT:ircafe}"
      realName: "${IRCAFE_REALNAME:IRCafe User}"

      sasl:
        enabled: false
        username: "${IRCAFE_SASL_USERNAME:}"
        password: "${IRCAFE_SASL_PASSWORD:}"
        mechanism: "PLAIN"

      autoJoin:
        - "#test"
